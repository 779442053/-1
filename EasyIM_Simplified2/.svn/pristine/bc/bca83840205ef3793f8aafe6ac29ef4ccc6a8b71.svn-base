//
//  YKUserInfoManager.m
//  kin
//
//  Created by 源库 on 2017/3/4.
//  Copyright © 2017年 yuanku. All rights reserved.
//

#import "YKUserInfoManager.h"
#import <YYModel.h>

@implementation YKUserInfoManager


+ (BOOL)isLogin {
    return [self userInfo].sessionID.length == 0?NO:YES;
}

/**
 设置用户信息
 
 @param userInfo 用户信息
 */
+ (void)setUserInfo:(YKUserInfo *)userInfo {
    
    if (userInfo == nil) {
        return;
    }
    
    //将所有的nil替换成@""
    u_int count;
    objc_property_t *properties = class_copyPropertyList([userInfo class], &count);
    
    for (int i = 0; i<count; i++) {
        const char* propertyName = property_getName(properties[i]);
        NSString *propertyNameString = [NSString stringWithUTF8String: propertyName];
        id propertyValue = [userInfo valueForKey:(NSString *)propertyNameString];
        if (!propertyValue) {
            [userInfo setValue:@"" forKey:propertyNameString];
        }
    }
    
    NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
    NSString *userInfoJsonString = [userInfo yy_modelToJSONString];
    userInfoJsonString = [userInfoJsonString stringByReplacingOccurrencesOfString:@"(null)" withString:@""];
    [defaults setObject:userInfoJsonString forKey:YKUSERMANAGER_USERINFO];
    [defaults synchronize];
}

/**
 获取用户信息
 */
+ (YKUserInfo *)userInfo {
    
    NSUserDefaults *defaults = [NSUserDefaults standardUserDefaults];
    NSString *userInfoJsonString = [defaults objectForKey:YKUSERMANAGER_USERINFO];
    YKUserInfo *userInfo = [YKUserInfo yy_modelWithJSON:userInfoJsonString];
    return userInfo;
}


@end
