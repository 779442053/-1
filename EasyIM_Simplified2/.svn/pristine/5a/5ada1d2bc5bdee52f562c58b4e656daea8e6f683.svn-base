//
//  UserInfoNavView.m
//  EasyIM
//
//  Created by 栾士伟 on 2019/4/14.
//  Copyright © 2019年 Looker. All rights reserved.
//

#import "UserInfoNavView.h"

#define nav_height              (SCREEN_HEIGHT >= 812.0 ? 88 : 64)

NSInteger const UserInfoViewHeight = 180;

@interface UserInfoNavView()

@property (nonatomic,  weak)   UIImageView     *headerView;
@property (nonatomic,  weak)   UILabel         *nicknameLabel;
@property (nonatomic,  weak)   UILabel         *detailLabel;
@property (nonatomic,  weak)   UIImageView     *topView;
@property (nonatomic,  weak)   UIView          *bgView;
@property (nonatomic,strong)   UIButton        *rightBtn;

@end

@implementation UserInfoNavView

- (instancetype)initWithFrame:(CGRect)frame {
    self = [super initWithFrame:frame];
    if (self) {
        [self setUp];
    }
    return self;
}

- (void)setUp {
    
    UIImageView *topView = [[UIImageView alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH, UserInfoViewHeight)];
    [self addSubview:topView];
    self.topView  = topView;
    
    //视图背景图
    UIView *bgView = [[UIView alloc] initWithFrame:CGRectMake(0, 0, SCREEN_WIDTH, UserInfoViewHeight)];
    bgView.backgroundColor = MMRGB(0x476390);
    [self addSubview:bgView];
    self.bgView = bgView;
    
    // 导航栏左侧返回按钮
    UIButton *backBtn = [UIButton buttonWithType:UIButtonTypeCustom];
    backBtn.frame = CGRectMake(20, (ISIphoneX?K_APP_IPHONX_TOP:20) + 15, 24, 24);
    [backBtn setImage:[UIImage imageNamed:@"App_back"] forState:UIControlStateNormal];
    backBtn.adjustsImageWhenHighlighted = NO;
    [backBtn addTarget:self action:@selector(leftBtnClick) forControlEvents:UIControlEventTouchUpInside];
    [bgView addSubview:backBtn];
    
    self.rightBtn = [UIButton buttonWithType:UIButtonTypeCustom];
    self.rightBtn.frame = CGRectMake(SCREEN_WIDTH-40, (ISIphoneX?K_APP_IPHONX_TOP:20) + 15, 30, 30);
    [self.rightBtn setImage:[UIImage imageNamed:@"edit1"] forState:UIControlStateNormal];
    self.rightBtn.imageView.size = CGSizeMake(30, 30);
    [self.rightBtn addTarget:self action:@selector(rightClick:) forControlEvents:UIControlEventTouchUpInside];
    [bgView addSubview:self.rightBtn];
    
    
    //实现模糊效果
    UIVisualEffectView *visualEffectView = [[UIVisualEffectView alloc] initWithEffect:[UIBlurEffect effectWithStyle:UIBlurEffectStyleDark]];
    visualEffectView.frame = CGRectMake(0, 0, SCREEN_WIDTH, UserInfoViewHeight);
    visualEffectView.alpha = 0.95;
    [topView addSubview:visualEffectView];
    
    //头像
    UITapGestureRecognizer *tapGesture = [[UITapGestureRecognizer alloc]init];
    tapGesture.numberOfTapsRequired = 1;
    [tapGesture addTarget:self action:@selector(clickToSeeALargerVersion:)];
    UIImageView *headerView = [[UIImageView alloc] init];
    [headerView setImage:[UIImage imageNamed:@"img_hard"]];
    headerView.userInteractionEnabled = YES;
    self.headerView = headerView;
    [self.headerView addGestureRecognizer:tapGesture];
    [bgView addSubview:headerView];
    [self.headerView setImage:[UIImage imageNamed:@"contacts_group_icon"]];
    
    //昵称
    UILabel *nicknameLabel = [[UILabel alloc] init];
    nicknameLabel.textColor = [UIColor whiteColor];
    nicknameLabel.font = [UIFont boldSystemFontOfSize:17];
    nicknameLabel.textAlignment = NSTextAlignmentLeft;
    self.nicknameLabel = nicknameLabel;
    [bgView addSubview:nicknameLabel];
    
    //详细
    UILabel *detailLabel = [[UILabel alloc] init];
    detailLabel.textColor = [UIColor lightGrayColor];
    detailLabel.font = [UIFont boldSystemFontOfSize:13];
    detailLabel.textAlignment = NSTextAlignmentLeft;
    self.detailLabel = detailLabel;
    [bgView addSubview:detailLabel];
    
    [headerView mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.mas_equalTo(bgView).offset(30+nav_height);
        make.left.mas_equalTo(bgView).offset(20);
        make.height.width.mas_equalTo(53);
    }];
    
    [headerView.layer setCornerRadius:26.5];
    [headerView.layer setMasksToBounds:YES];
    
    //昵称
    [nicknameLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.top.mas_equalTo(bgView).offset(40+nav_height);
        make.left.mas_equalTo(headerView.mas_right).offset(10);
    }];
    
    //详细
    [detailLabel mas_makeConstraints:^(MASConstraintMaker *make) {
        make.bottom.mas_equalTo(nicknameLabel).offset(20);
        make.left.mas_equalTo(nicknameLabel);
    }];
}

- (void)leftBtnClick {
    
    [self.navController popViewControllerAnimated:YES];
}

- (void)setUserName:(NSString *)userName {
    _userName = userName;
    self.nicknameLabel.text = userName;
}

- (void)setUserImage:(NSString *)userImage
{
    _userImage = userImage;
    [self.headerView sd_setImageWithURL:[NSURL URLWithString:userImage] placeholderImage:[UIImage imageNamed:@"woman_line"] options:SDWebImageRetryFailed | SDWebImageLowPriority];
}

- (void)setIsHideRightBtn:(BOOL )isHideRightBtn
{
    _isHideRightBtn = isHideRightBtn;
    self.rightBtn.hidden = isHideRightBtn;
}

- (void)setUserDetail:(NSString *)userDetail
{
    _userDetail = userDetail;
    self.detailLabel.text = userDetail;
}

#pragma mark -- 跳转到好友设置页

- (void)rightClick:(UIButton *)sender
{
    if (_deletgate && [_deletgate respondsToSelector:@selector(rightAction:)]) {
        [self.deletgate rightAction:sender];
    }
}

#pragma mark - 点击看大图

- (void)clickToSeeALargerVersion:(UIGestureRecognizer *)gesture
{
    
}

@end
