//
//  MMBaseViewController.m
//  EasyIM
//
//  Created by momo on 2019/5/11.
//  Copyright © 2019年 Looker. All rights reserved.
//

#import "MMBaseViewController.h"

#import "YKUserInfoManager.h"
#import "LoginVC.h"

@interface MMBaseViewController ()

@end

@implementation MMBaseViewController

- (void)viewDidLoad {
    [super viewDidLoad];
    self.view.backgroundColor = [UIColor colorWithHexString:@"f2f2f7"];
}


/**
 设置返回标题并跳转至下一界面
 
 @param viewController 下一界面
 @param animated 是否动画
 */
- (void)baseVCPushViewController:(MMBaseViewController *)viewController animated:(BOOL)animated {
    
    WEAKSELF
    [self coreBaseVCPushViewController:viewController animated:animated moreConditions:^{
        //        if ([viewController getNeedLogin] && ![weakSelf isLogin]) return;
        
        [weakSelf.navigationController pushViewController:viewController animated:animated];
    }];
}


//MARK: - 状态栏颜色
-(UIStatusBarStyle)preferredStatusBarStyle{
    return UIStatusBarStyleLightContent;
}

- (BOOL)LoginStatus{
    return NO;
}

- (void)setNavgationTitle:(NSString *)navgationTitle {
    _navgationTitle = navgationTitle;
    
    if (self.tabBarController) {
        self.tabBarController.navigationItem.title = navgationTitle;
    }else{
        self.navigationItem.title = navgationTitle;
    }
}

- (BOOL)isLogin {
    UINavigationController *nav = [[UINavigationController alloc] initWithRootViewController:[LoginVC new]];
    [self.navigationController presentViewController:nav animated:YES completion:nil];
    return NO;
}


- (void)gotoBack{
    [self.navigationController popViewControllerAnimated:YES];
}

- (BOOL)isIphoneX{
    if (@available(iOS 11.0, *)) {
        CGFloat a =  [[UIApplication sharedApplication] delegate].window.safeAreaInsets.bottom;
        if (a>0) {
            return YES;
        }else{
            return NO;
        }
    }
    return NO;
}

- (void)addBackBtn {
    UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
    button.frame = CGRectMake(0, StatusBarH, 44, 44);
    [button setImage:[UIImage imageNamed:@"App_back"] forState:UIControlStateNormal];
    [button addTarget:self action:@selector(backAction) forControlEvents:UIControlEventTouchUpInside];

    [button setImageEdgeInsets:UIEdgeInsetsMake(0, 0, 0, 32)];
    UIBarButtonItem *infoBtn = [[UIBarButtonItem alloc] initWithCustomView:button];
    if (self.tabBarController.navigationItem) {
        self.tabBarController.navigationItem.leftBarButtonItem = infoBtn;
    }
    else{
        self.navigationItem.leftBarButtonItem = infoBtn;
    }
    
}

- (void)backAction {
    //present 进入
    if ([self presentingViewController]) {
        [self dismissViewControllerAnimated:YES completion:nil];
    }
    //push 进入
    else{
       [self.navigationController popViewControllerAnimated:YES];
    }
}

- (void)addRightBtnWithImage:(UIImage *)image
{
    [self setupRightBtnWithImage:image andTitle:nil];
}

- (void)addRightBtnWithTitle:(NSString *)title
{
    [self setupRightBtnWithImage:nil andTitle:title];
}


- (void)setupRightBtnWithImage:(UIImage *)image andTitle:(NSString *)title
{
    UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
    button.size = CGSizeMake(44, 44);
    
    if (image) {
        [button setImage:image forState:UIControlStateNormal];
    }
    
    if (title) {
        [button setTitle:title forState:UIControlStateNormal];
        [button setTitleColor:RGBCOLOR(18.0, 183.0, 245.0) forState:UIControlStateNormal];
    }
    
    [button addTarget:self
               action:@selector(rightAction)
     forControlEvents:UIControlEventTouchUpInside];
    
    UIBarButtonItem *infoBtn = [[UIBarButtonItem alloc] initWithCustomView:button];
    
    if (self.tabBarController.navigationItem) {
        self.tabBarController.navigationItem.rightBarButtonItems = nil;
        self.tabBarController.navigationItem.rightBarButtonItem = infoBtn;
    }
    else{
        self.navigationItem.rightBarButtonItems = nil;
        self.navigationItem.rightBarButtonItem = infoBtn;
    }
}


- (void)addRightBtnCallback:(void(^ _Nonnull)(UIButton *_btn))btnCallback{
    UIButton *button = [UIButton buttonWithType:UIButtonTypeCustom];
    button.size = CGSizeMake(44, 44);
    [button addTarget:self action:@selector(rightAction) forControlEvents:UIControlEventTouchUpInside];
    
    btnCallback(button);
    
    UIBarButtonItem *infoBtn = [[UIBarButtonItem alloc] initWithCustomView:button];
    if (self.tabBarController.navigationItem) {
        self.tabBarController.navigationItem.rightBarButtonItem = infoBtn;
    }
    else{
        self.navigationItem.rightBarButtonItem = infoBtn;
    }
}

- (void)rightAction {
    
}

@end
